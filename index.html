<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sanya 2025 Wrapped</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="loader">
  <div id="loaderCard">
    <div id="loaderPercent"></div>
    <div id="loaderText"></div>
    <div class="loader-ring"></div>
  </div>
</div>

<div id="confetti"></div>

<div class="app">
  <div class="progress" id="progress" aria-hidden="true"></div>

  <div class="track" id="track" aria-live="polite"></div>

  <div class="hint">–õ–∏—Å—Ç–∞–π —Å—Ç—Ä–µ–ª–∫–∞–º–∏</div>
  <div class="dots" id="dots"></div>

  <div class="controls">
    <button class="btn" id="prev" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥">‚Üê</button>
    <button class="btn" id="next" aria-label="–°–ª–µ–¥—É—é—â–∏–π —Å–ª–∞–π–¥">‚Üí</button>
  </div>
</div>

<script>
(() => {
  const slides = [
    {pill:"Wrapped 2025",title:"–ò—Ç–æ–≥–∏",big:"2025",desc:"–ù–µ–º–Ω–æ–≥–æ —Ü–∏—Ñ—Ä –∏ –Ω–µ–º–Ω–æ–≥–æ —é–º–æ—Ä–∞."},
    {pill:"Wrapped 2025",title:"–ë—ç–º–±–∏ —Ç—è–≤–∫–Ω—É–ª–∞",big:"‚âà 5",desc:"–ù–æ –æ–Ω–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ —Ç–µ–±—è –ª—é–±–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ—Ö."},
    {pill:"Wrapped 2025",title:"–°–ª–æ–≤–æ ¬´–∫_–∫_—Ç—å¬ª",big:"32 —Ä–∞–∑–∞",desc:"–ü–æ-—Ä–∞–∑–Ω–æ–º—É –∏ –∫–∞–∂–¥—ã–π –≤ —Å–≤–æ–µ –≤—Ä–µ–º—è."},
    {pill:"Wrapped 2025",title:"¬´–ß—Ç–æ –Ω–∞ —É–∂–∏–Ω?¬ª",big:"30 —Ä–∞–∑",desc:"–ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å –≥–æ–¥–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø—ã—Ç–∞–ª–∏—Å—å –ø—Ä–∏–¥—É–º–∞—Ç—å –æ—Ç–≤–µ—Ç."},
    {pill:"Wrapped 2025",title:"¬´–Ø –≤—ã—à–µ–ª¬ª",big:"29 —Ä–∞–∑",desc:"–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ."},
    {pill:"Wrapped 2025",title:"¬´–ß–º–æ–∫¬ª",big:"398",desc:"–ü–æ—á—Ç–∏ 400 ‚Äî –Ω–æ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –±–æ–ª—å—à–µ. –¶–µ–ª—å –Ω–∞ 2026 —Ö3."},
    {pill:"Wrapped 2025",title:"–ü–æ–±—ã–≤–∞–ª–∏ –≤ –Ω–æ–≤—ã—Ö –º–µ—Å—Ç–∞—Ö",big:"2 —Ä–∞–∑–∞",desc:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –∏ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥."},
    {pill:"Wrapped 2025",title:"–ü—Ä–æ–≤–µ–ª–∏ –Ω–æ–Ω-—Å—Ç–æ–ø",big:"7 200 –º–∏–Ω.",desc:"–ò –¥–∞–∂–µ –Ω–µ —Ä—É–≥–∞–ª–∏—Å—å!"},
    {pill:"Wrapped 2025",title:"–°–∞–º—ã–π —Å–ø–æ–∫–æ–π–Ω—ã–π –º–æ–º–µ–Ω—Ç",big:"–°–æ–Ω",desc:"–ö–æ–≥–¥–∞ —è –¥–æ—Å—Ç–∞—é —Ç–µ–±—è –Ω–æ–∂–∫–æ–π."},
    {pill:"Wrapped 2025",title:"–õ—É—á—à–µ–µ –∑–∞ –≥–æ–¥",big:"–¢—ã",desc:"–ü—É—Å—Ç—å 2026 –±—É–¥–µ—Ç –µ—â—ë –ª—É—á—à–µ. –Ø ‚ù§Ô∏è —Ç–µ–±—è!"}
  ];

  const app = document.querySelector(".app");
  const track = document.getElementById("track");
  const dots = document.getElementById("dots");
  const progress = document.getElementById("progress");

  const btnPrev = document.getElementById("prev");
  const btnNext = document.getElementById("next");

  let index = 0;
  let isBusy = false; // —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã

  // ===== Render slides =====
  slides.forEach((s, i) => {
    const slide = document.createElement("section");
    slide.className = "slide";
    slide.innerHTML = `
      <div class="card">
        <div class="card-inner">
          <div class="meta">
            <div class="pill">üéâ ${s.pill}</div>
            <div>${i + 1}/${slides.length}</div>
          </div>
          <h1 class="title">${s.title}</h1>
          <div class="big">${s.big}</div>
          <p class="desc">${s.desc}</p>
        </div>
      </div>
    `;
    track.appendChild(slide);

    const dot = document.createElement("button");
    dot.type = "button";
    dot.className = "dot";
    dot.setAttribute("aria-label", `–°–ª–∞–π–¥ ${i + 1}`);
    dot.addEventListener("click", () => go(i, { animate: true }));
    dots.appendChild(dot);
  });

  // ===== Progress segments =====
  const segs = [];
  slides.forEach((_, i) => {
    const seg = document.createElement("button");
    seg.type = "button";
    seg.className = "seg";
    seg.setAttribute("aria-label", `–°–ª–∞–π–¥ ${i + 1}`);
    seg.innerHTML = `<div class="fill"></div>`;
    seg.addEventListener("click", () => go(i, { animate: true }));
    progress.appendChild(seg);
    segs.push(seg);
  });

  function slideWidth(){
    // –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è iOS/desktop
    const vv = window.visualViewport;
    return vv ? vv.width : app.clientWidth;
  }

  function baseXForIndex(i){
    return -i * slideWidth();
  }

  function setTrackPx(px, animate){
    track.classList.toggle("no-anim", !animate);
    track.style.transform = `translate3d(${px}px,0,0)`;
  }

  function setActiveUI(dirClass){
    document.querySelectorAll(".slide").forEach((s, j) => {
      s.classList.remove("active", "from-right", "from-left");
      if (j === index) s.classList.add("active", dirClass);
    });

    document.querySelectorAll(".dot").forEach((d, j) => {
      d.classList.toggle("active", j === index);
      d.setAttribute("aria-current", j === index ? "true" : "false");
    });

    segs.forEach((seg, j) => {
      const fill = seg.querySelector(".fill");
      if (j < index) fill.style.transform = "scaleX(1)";
      else if (j > index) fill.style.transform = "scaleX(0)";
      else fill.style.transform = "scaleX(1)";
    });

    btnPrev.disabled = (index === 0);
    btnNext.disabled = (index === slides.length - 1);
  }

  function go(i, { animate = true } = {}){
    if (isBusy) return;

    const prevIndex = index;
    index = Math.max(0, Math.min(slides.length - 1, i));
    const dir = index > prevIndex ? "from-right" : "from-left";

    isBusy = true;
    setTrackPx(baseXForIndex(index), animate);
    setActiveUI(dir);

    // —Å–Ω—è—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    if (!animate){
      isBusy = false;
    } else {
      window.setTimeout(() => { isBusy = false; }, 650);
    }
  }

  // ===== Controls =====
  btnNext.addEventListener("click", () => go(index + 1, { animate: true }));
  btnPrev.addEventListener("click", () => go(index - 1, { animate: true }));

  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowRight") go(index + 1, { animate: true });
    if (e.key === "ArrowLeft") go(index - 1, { animate: true });
  });

  // ===== Re-snap on resize (incl. iOS address bar / visualViewport) =====
  function resnap(){
    setTrackPx(baseXForIndex(index), false);
    setActiveUI("from-right");
  }

  window.addEventListener("resize", resnap);
  if (window.visualViewport){
    window.visualViewport.addEventListener("resize", resnap);
  }

  // ===== Init =====
  go(0, { animate: false });
  requestAnimationFrame(() => go(0, { animate: false }));
})();
</script>

<script>
  // PRELOADER (6s) + CONFETTI
  document.body.classList.add("is-loading");

  requestAnimationFrame(() => {
    setTimeout(() => {
      const loader = document.getElementById("loader");
      if (loader) loader.remove();
      document.body.classList.remove("is-loading");
      launchConfetti();
    }, 6000);
  });

  function launchConfetti(){
    const wrap = document.getElementById("confetti");
    if (!wrap) return;

    const colors = ["#e33025","#e05188","#f2cecb"];
    const pieces = 200;

    for (let i = 0; i < pieces; i++){
      const el = document.createElement("div");
      el.className = "confetti";
      el.style.left = (Math.random() * 100) + "vw";
      el.style.backgroundColor = colors[(Math.random() * colors.length) | 0];

      const dur = 2.2 + Math.random() * 2.3;
      const delay = Math.random() * 0.15;
      el.style.animationDuration = dur + "s";
      el.style.animationDelay = delay + "s";

      const rot = Math.random() * 360;
      const drift = (Math.random() * 160 - 80);
      el.style.transform = `translateX(${drift}px) rotate(${rot}deg)`;

      wrap.appendChild(el);
      setTimeout(() => el.remove(), (dur + delay) * 1000 + 200);
    }
  }
</script>

</body>
</html>
